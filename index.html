<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JOHNGALTAZ | E-commerce Platform</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: '#0B1416', accent: '#F85C58', base: '#F6F6F3',
                        neutral: '#D6D6D6', graytext: '#666666'
                    },
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        body { background-color: #F6F6F3; color: #0B1416; overflow-x: hidden; }
        .card-transition { transition: all 0.2s ease; }
        .card-transition:hover { transform: translateY(-4px); box-shadow: 0 10px 25px -5px rgba(11, 20, 22, 0.1); }
        .diff-highlight { background-color: #fef08a; } /* Желтая подсветка отличий */
        .hide-scroll::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- 1. MOCK DATA (Расширенный каталог) ---
        const DB = [
            { id: 1, name: "THUNDEROBOT Zero 2024", cat: "Игровые ноутбуки", brand: "Thunderobot", price: 950000, oldPrice: 1050000, stock: "В наличии", specs: { "CPU": "i9-13900HX", "GPU": "RTX 4070", "RAM": "32GB", "SSD": "1TB", "Экран": "16' 240Hz", "Вес": "2.5 кг" }, imgs: ["https://images.unsplash.com/photo-1603302576837-37561b2e2302?auto=format&fit=crop&q=80&w=400", "https://images.unsplash.com/photo-1593640408182-31c70c8268f5?auto=format&fit=crop&q=80&w=400"], variants: { ram: [{l:"32GB", d:0}, {l:"64GB", d:80000}], ssd: [{l:"1TB", d:0}, {l:"2TB", d:45000}] }, desc: { forWhom: "Для хардкорных геймеров и 3D-дизайнеров.", pros: "Топовое охлаждение, 240Hz экран.", box: "Ноутбук, ЗУ 300W, документация." }, cross: [3] },
            { id: 2, name: "Thunderobot 911X", cat: "Игровые ноутбуки", brand: "Thunderobot", price: 520000, stock: "Предзаказ", deliveryText: "Поставка до Алматы ~ 8 дней", specs: { "CPU": "i5-12450H", "GPU": "RTX 3050", "RAM": "16GB", "SSD": "512GB", "Экран": "15.6' 144Hz", "Вес": "2.2 кг" }, imgs: ["https://images.unsplash.com/photo-1593640408182-31c70c8268f5?auto=format&fit=crop&q=80&w=400"], desc: { forWhom: "Для начинающих.", pros: "Цена/качество.", box: "Ноутбук, ЗУ." }, cross: [3] },
            { id: 3, name: "Мышь ML903", cat: "Периферия", brand: "Thunderobot", price: 35000, stock: "В наличии", specs: { "Сенсор": "PAW3395", "Вес": "65г", "Тип": "Беспроводная" }, imgs: ["https://images.unsplash.com/photo-1527864550417-7fd91fc51a46?auto=format&fit=crop&q=80&w=400"] },
            { id: 4, name: "Аппарат SMAS UltraX", cat: "Медицинское оборудование", brand: "MedTech", price: 0, priceText: "По запросу", stock: "Под заказ", specs: { "Рег. уд.": "РК-МТ-001", "Гарантия": "2 года" }, imgs: ["https://images.unsplash.com/photo-1516549655169-df83a0774514?auto=format&fit=crop&q=80&w=400"], isB2B: true, warning: "Внимание: Требуется медицинская лицензия.", docs: ["РУ_МЗ_РК.pdf", "Инструкция.pdf"] },
            { id: 5, name: "Лазер CosmePro", cat: "Косметическое оборудование", brand: "CosmePro", price: 2500000, stock: "Предзаказ", deliveryText: "Поставка ~ 14 дней", specs: { "Мощность": "1200W", "Тип лазера": "Диодный" }, imgs: ["https://images.unsplash.com/photo-1590424693955-f7035eb4e622?auto=format&fit=crop&q=80&w=400"], isB2B: true },
            { id: 6, name: "Монитор 27' 165Hz", cat: "Периферия", brand: "Thunderobot", price: 140000, stock: "В наличии", specs: { "Диагональ": "27'", "Частота": "165Hz", "Матрица": "IPS" }, imgs: ["https://images.unsplash.com/photo-1527443224154-c4a3942d3acf?auto=format&fit=crop&q=80&w=400"] },
            { id: 7, name: "Кофемашина Barista", cat: "Мелко-бытовая техника", brand: "HomeTech", price: 180000, stock: "В наличии", specs: { "Тип": "Рожковая", "Давление": "15 бар" }, imgs: ["https://images.unsplash.com/photo-1517246286411-8bb31bf32f22?auto=format&fit=crop&q=80&w=400"] }
        ];

        // --- 2. COMPONENTS ---
        const Btn = ({ children, v = 'pri', cls = '', ...p }) => {
            const s = { pri: "bg-accent text-white hover:brightness-110", sec: "border-2 border-brand text-brand hover:bg-brand hover:text-white", out: "border border-neutral text-brand hover:bg-neutral/30", ghost: "text-graytext hover:text-brand" };
            return <button className={`px-4 py-2 rounded-lg font-medium transition-all flex items-center justify-center gap-2 ${s[v]} ${cls}`} {...p}>{children}</button>;
        };

        const App = () => {
            const [view, setView] = useState('home');
            const [history, setHistory] = useState(['home']); // Для кнопки "Назад"
            const [activeP, setActiveP] = useState(null);
            const [cart, setCart] = useState([]);
            const [comp, setComp] = useState([]);
            const [favs, setFavs] = useState([]);
            const [modal, setModal] = useState(null);
            const [search, setSearch] = useState('');
            const [menuOpen, setMenuOpen] = useState(false);
            const [fabOpen, setFabOpen] = useState(false);

            const fmtPrice = p => p === 0 ? "По запросу" : new Intl.NumberFormat('ru-KZ').format(p) + ' ₸';
            
            const nav = (v, data = null) => { 
                window.scrollTo(0,0); 
                if(data) setActiveP(data); 
                setHistory(prev => [...prev, v]);
                setView(v); 
                setMenuOpen(false);
            };
            
            const goBack = () => {
                if(history.length > 1) {
                    const newHist = [...history];
                    newHist.pop();
                    setHistory(newHist);
                    setView(newHist[newHist.length - 1]);
                } else { nav('home'); }
            };

            const toggleComp = (p) => setComp(prev => prev.find(x=>x.id===p.id) ? prev.filter(x=>x.id!==p.id) : (prev.length<4 ? [...prev, p] : prev));
            const toggleFav = (id) => setFavs(prev => prev.includes(id) ? prev.filter(x=>x!==id) : [...prev, id]);

            useEffect(() => { lucide.createIcons(); });

            // --- HEADER ---
            const Header = () => (
                <header className="bg-brand text-white sticky top-0 z-40 p-4 shadow-md">
                    <div className="max-w-7xl mx-auto flex justify-between items-center gap-4">
                        <div className="flex items-center gap-4">
                            <button className="md:hidden" onClick={()=>setMenuOpen(!menuOpen)}><i data-lucide="menu"></i></button>
                            <div className="text-2xl font-bold cursor-pointer" onClick={()=>nav('home')}>JOHNGALTAZ</div>
                        </div>
                        
                        <nav className="hidden md:flex gap-6 text-sm text-neutral">
                            <button className="hover:text-white" onClick={()=>nav('home')}>Главная</button>
                            <button className="hover:text-white" onClick={()=>nav('catalog')}>Каталог</button>
                        </nav>

                        <div className="flex-1 max-w-md hidden lg:block relative text-brand">
                            <input type="text" placeholder="Поиск товара..." value={search} onChange={e=>{setSearch(e.target.value); if(view!=='catalog') nav('catalog');}} className="w-full rounded-lg px-4 py-2 outline-none focus:ring-2 ring-accent" />
                            <i data-lucide="search" className="absolute right-3 top-2.5 w-5 h-5 text-graytext"></i>
                        </div>

                        <div className="flex gap-4">
                            <button onClick={()=>nav('compare')} className="relative" title="Сравнение"><i data-lucide="bar-chart-2"></i>{comp.length>0 && <span className="absolute -top-2 -right-2 bg-accent text-xs rounded-full w-4 h-4 text-center">{comp.length}</span>}</button>
                            <button onClick={()=>nav('cart')} className="relative" title="Корзина"><i data-lucide="shopping-cart"></i>{cart.length>0 && <span className="absolute -top-2 -right-2 bg-accent text-xs rounded-full w-4 h-4 text-center">{cart.reduce((a,c)=>a+c.qty,0)}</span>}</button>
                        </div>
                    </div>
                    {/* Мобильное меню */}
                    {menuOpen && (
                        <div className="md:hidden absolute top-full left-0 w-full bg-brand p-4 flex flex-col gap-4 border-t border-graytext z-50">
                            <input type="text" placeholder="Поиск..." value={search} onChange={e=>{setSearch(e.target.value); nav('catalog');}} className="w-full rounded text-brand p-2" />
                            <button onClick={()=>nav('home')} className="text-left font-medium">Главная</button>
                            <button onClick={()=>nav('catalog')} className="text-left font-medium">Каталог</button>
                        </div>
                    )}
                </header>
            );

            // --- ДОПОЛНИТЕЛЬНЫЕ ЭЛЕМЕНТЫ ---
            const TopBar = () => (
                <div className="flex items-center gap-2 mb-6">
                    {view !== 'home' && <Btn v="ghost" cls="p-0 hover:bg-transparent" onClick={goBack}><i data-lucide="arrow-left" className="w-4 h-4"></i> Назад</Btn>}
                </div>
            );

            // --- 3. VIEWS ---

            // 3.1 HOME PAGE
            const Home = () => (
                <div className="fade-in space-y-12">
                    {/* Hero Banner */}
                    <div className="bg-brand text-white p-8 md:p-16 rounded-2xl flex flex-col md:flex-row items-center gap-8 relative overflow-hidden">
                        <div className="z-10 flex-1">
                            <h1 className="text-4xl md:text-5xl font-bold mb-4">Экосистема технологий</h1>
                            <p className="text-neutral mb-8 max-w-lg">Официальные поставки оборудования с гарантией. B2C и B2B решения для всего Казахстана.</p>
                            <Btn onClick={()=>nav('catalog')} cls="py-3 px-8 text-lg">Перейти к покупкам</Btn>
                        </div>
                        <div className="flex-1 opacity-50 md:opacity-100">
                            <img src={DB[0].imgs[0]} className="w-full max-w-md mx-auto mix-blend-screen transform hover:scale-105 transition-transform" />
                        </div>
                    </div>

                    {/* Popular Categories */}
                    <div>
                        <h2 className="text-2xl font-bold mb-6">Популярные категории</h2>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            {["Игровые ноутбуки", "Периферия", "Мед. оборудование", "Косметология"].map(c => (
                                <div key={c} onClick={()=>nav('catalog')} className="bg-white p-6 rounded-xl text-center font-semibold cursor-pointer card-transition border border-neutral hover:border-accent text-brand">{c}</div>
                            ))}
                        </div>
                    </div>

                    {/* Featured Products */}
                    <div>
                        <h2 className="text-2xl font-bold mb-6">Хиты продаж</h2>
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                            {DB.slice(0,4).map(p => <ProductCard key={p.id} p={p} />)}
                        </div>
                    </div>
                </div>
            );

            // 3.2 CATALOG (PLP)
            const ProductCard = ({ p }) => (
                <div className="bg-white rounded-xl p-4 card-transition flex flex-col cursor-pointer border border-neutral relative group" onClick={()=>nav('pdp', p)}>
                    {p.oldPrice && <span className="absolute top-2 left-2 z-10 bg-accent text-white text-xs px-2 py-1 rounded">Скидка</span>}
                    <div className="relative aspect-square mb-4 bg-base rounded-lg overflow-hidden">
                        <img src={p.imgs[0]} className="w-full h-full object-cover mix-blend-multiply group-hover:scale-105 transition-transform" />
                        <div className="absolute top-2 right-2 flex flex-col gap-2">
                            <button onClick={(e)=>{e.stopPropagation(); toggleFav(p.id);}} className={`p-2 bg-white rounded-full shadow ${favs.includes(p.id)?'text-accent':'text-graytext'}`}><i data-lucide="heart" className="w-4 h-4"></i></button>
                            <button onClick={(e)=>{e.stopPropagation(); toggleComp(p);}} className={`p-2 bg-white rounded-full shadow ${comp.find(x=>x.id===p.id)?'text-brand':'text-graytext'}`}><i data-lucide="bar-chart-2" className="w-4 h-4"></i></button>
                        </div>
                    </div>
                    <div className="flex-1">
                        <h3 className="font-bold text-brand hover:text-accent mb-1 line-clamp-2">{p.name}</h3>
                        <div className="flex flex-wrap gap-1 mb-2">
                            {Object.values(p.specs||{}).slice(0,2).map((s,i)=><span key={i} className="text-[10px] bg-base px-2 py-1 rounded text-graytext">{s}</span>)}
                        </div>
                    </div>
                    <div className={`text-xs my-2 font-medium ${p.stock==='В наличии'?'text-green-600':'text-orange-500'}`}>{p.stock} {p.stock==='Предзаказ'&&<span className="block text-graytext font-normal">~8 дней</span>}</div>
                    <div className="mb-3">
                        {p.oldPrice && <div className="text-xs text-graytext line-through">{fmtPrice(p.oldPrice)}</div>}
                        <div className="text-xl font-bold">{p.priceText || fmtPrice(p.price)}</div>
                    </div>
                    {p.isB2B ? <Btn v="sec" cls="w-full text-sm" onClick={(e)=>{e.stopPropagation();setModal({t:'quote', p});}}>Запросить КП</Btn> : <Btn cls="w-full text-sm" onClick={(e)=>{e.stopPropagation(); setCart([...cart, {...p, qty:1, finalPrice: p.price}]); alert('Добавлено!');}}>В корзину</Btn>}
                </div>
            );

            const Catalog = () => {
                const [cat, setCat] = useState('Все');
                const [gpu, setGpu] = useState('');
                const res = DB.filter(p => (cat==='Все' || p.cat===cat) && p.name.toLowerCase().includes(search.toLowerCase()) && (gpu==='' || p.specs?.GPU?.includes(gpu)));
                
                return (
                    <div className="flex flex-col lg:flex-row gap-8 fade-in">
                        <aside className="w-full lg:w-64 shrink-0 bg-white p-5 rounded-xl border border-neutral h-fit lg:sticky top-24">
                            <h2 className="font-bold mb-4">Категории</h2>
                            {["Все", "Игровые ноутбуки", "Периферия", "Мелко-бытовая техника", "Косметическое оборудование", "Медицинское оборудование"].map(c => (
                                <label key={c} className="flex items-center mb-2 text-sm cursor-pointer"><input type="radio" checked={cat===c} onChange={()=>setCat(c)} className="mr-2 text-accent focus:ring-accent"/>{c}</label>
                            ))}
                            
                            {/* Специфичный фильтр для ноутбуков */}
                            {cat === 'Игровые ноутбуки' && (
                                <div className="mt-4 pt-4 border-t border-neutral">
                                    <h3 className="font-bold mb-2 text-sm">Видеокарта (GPU)</h3>
                                    <select className="w-full border rounded p-2 text-sm bg-white" onChange={e=>setGpu(e.target.value)}><option value="">Все</option><option value="RTX 3050">RTX 3050</option><option value="RTX 4070">RTX 4070</option></select>
                                </div>
                            )}
                            <Btn v="out" cls="w-full mt-6 text-xs" onClick={()=>setModal({t:'form'})}>Подобрать оборудование</Btn>
                        </aside>
                        
                        <div className="flex-1">
                            <div className="flex justify-between items-center mb-6">
                                <h1 className="text-2xl font-bold">{cat === 'Все' ? 'Все товары' : cat}</h1>
                                <span className="text-sm text-graytext">Найдено: {res.length}</span>
                            </div>
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                                {res.map(p => <ProductCard key={p.id} p={p} />)}
                            </div>
                        </div>
                    </div>
                );
            };

            // 3.3 PRODUCT DETAIL (PDP)
            const PDP = () => {
                const p = activeP;
                const [imgIdx, setImgIdx] = useState(0);
                const [r, setR] = useState(p.variants?.ram[0]);
                const [s, setS] = useState(p.variants?.ssd[0]);
                
                // Пересчет цены
                const currPrice = p.basePrice ? (p.price + (r?.d||0) + (s?.d||0)) : 0;
                // Кросс-сейл
                const crossSells = DB.filter(x => p.cross?.includes(x.id));

                return (
                    <div className="fade-in">
                        <TopBar />
                        <div className="bg-white p-6 md:p-10 rounded-xl border border-neutral mb-8">
                            <div className="grid md:grid-cols-2 gap-10">
                                {/* Галерея */}
                                <div>
                                    <div className="aspect-square bg-base rounded-xl overflow-hidden mb-4"><img src={p.imgs[imgIdx]} className="w-full h-full object-cover mix-blend-multiply" /></div>
                                    {p.imgs.length > 1 && (
                                        <div className="flex gap-2">
                                            {p.imgs.map((im, i) => <img key={i} src={im} onClick={()=>setImgIdx(i)} className={`w-16 h-16 rounded border-2 cursor-pointer ${imgIdx===i?'border-accent':'border-transparent'}`} />)}
                                        </div>
                                    )}
                                </div>
                                
                                {/* Инфо */}
                                <div>
                                    <h1 className="text-3xl font-bold mb-2 text-brand">{p.name}</h1>
                                    <div className="text-xs text-graytext mb-4">Артикул / SKU: {p.id}-{r?.l||'BASE'}-{s?.l||'BASE'}</div>
                                    
                                    <div className={`inline-block px-3 py-1 rounded-full text-xs font-medium mb-4 ${p.stock==='В наличии'?'bg-green-100 text-green-700':'bg-orange-100 text-orange-700'}`}>
                                        {p.stock} {p.stock==='Предзаказ'&&`(${p.deliveryText})`}
                                    </div>
                                    
                                    <div className="text-4xl font-bold text-brand mb-6">{p.priceText || fmtPrice(currPrice)}</div>
                                    
                                    {/* Варианты конфигурации */}
                                    {p.variants && (
                                        <div className="mb-6 space-y-4">
                                            <div>
                                                <span className="text-sm text-graytext block mb-2">Оперативная память (RAM):</span> 
                                                <div className="flex gap-2">{p.variants.ram.map(v=><Btn key={v.l} v={r.l===v.l?'sec':'out'} cls="text-sm py-1 px-3" onClick={()=>setR(v)}>{v.l}</Btn>)}</div>
                                            </div>
                                            <div>
                                                <span className="text-sm text-graytext block mb-2">Накопитель (SSD):</span> 
                                                <div className="flex gap-2">{p.variants.ssd.map(v=><Btn key={v.l} v={s.l===v.l?'sec':'out'} cls="text-sm py-1 px-3" onClick={()=>setS(v)}>{v.l}</Btn>)}</div>
                                            </div>
                                        </div>
                                    )}

                                    {/* Предупреждения и доки (Мед) */}
                                    {p.warning && <div className="bg-orange-50 text-orange-800 p-4 rounded-lg mb-6 text-sm border border-orange-200"><i data-lucide="alert-triangle" className="inline w-4 h-4 mr-2"></i>{p.warning}</div>}
                                    {p.docs && (
                                        <div className="mb-6">
                                            <span className="text-sm font-bold block mb-2">Документация:</span>
                                            {p.docs.map(d=><a key={d} href="#" className="flex items-center gap-2 text-accent text-sm mb-1 hover:underline"><i data-lucide="file-text" className="w-4 h-4"></i>{d}</a>)}
                                        </div>
                                    )}
                                    
                                    <div className="flex flex-col sm:flex-row gap-4 mb-8 pb-8 border-b border-neutral">
                                        {p.isB2B ? <Btn cls="flex-1 py-3 text-lg" onClick={()=>setModal({t:'quote', p})}>Запросить КП</Btn> : <><Btn cls="flex-1 py-3 text-lg" onClick={()=>{setCart([...cart, {...p, finalPrice: currPrice, variant: `${r?.l||''} ${s?.l||''}`, qty: 1}]); alert('Добавлено!');}}>Добавить в корзину</Btn><Btn v="out" onClick={()=>setModal({t:'1click', p})}>Купить в 1 клик</Btn></>}
                                    </div>

                                    {/* Структурированное описание */}
                                    {p.desc && (
                                        <div className="space-y-4 text-sm mb-8">
                                            <div><strong className="text-brand">Для кого:</strong> <span className="text-graytext">{p.desc.forWhom}</span></div>
                                            <div><strong className="text-brand">Преимущества:</strong> <span className="text-graytext">{p.desc.pros}</span></div>
                                            <div><strong className="text-brand">Комплектация:</strong> <span className="text-graytext">{p.desc.box}</span></div>
                                        </div>
                                    )}

                                    <h3 className="font-bold mb-4 text-lg">Характеристики</h3>
                                    <table className="w-full text-sm"><tbody>
                                        {Object.entries(p.specs||{}).map(([k,v]) => <tr key={k} className="border-b border-neutral last:border-0"><td className="py-2 text-graytext w-1/2">{k}</td><td className="py-2 font-medium">{v}</td></tr>)}
                                    </tbody></table>
                                </div>
                            </div>
                        </div>

                        {/* С этим покупают */}
                        {crossSells.length > 0 && (
                            <div>
                                <h3 className="text-xl font-bold mb-4">С этим покупают</h3>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    {crossSells.map(x => <ProductCard key={x.id} p={x} />)}
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // 3.4 COMPARE
            const Compare = () => {
                if(!comp.length) return <div className="text-center py-20"><TopBar/><h2 className="text-2xl font-bold mb-4">Сравнение пусто</h2><Btn onClick={()=>nav('catalog')}>В каталог</Btn></div>;
                const keys = [...new Set(comp.flatMap(p => Object.keys(p.specs||{})))];
                return (
                    <div className="fade-in">
                        <TopBar />
                        <div className="bg-white p-6 rounded-xl overflow-x-auto border border-neutral">
                            <h1 className="text-2xl font-bold mb-6">Сравнение товаров</h1>
                            <table className="w-full min-w-[600px] text-sm text-left">
                                <thead><tr><th className="w-48"></th>{comp.map(p => <th key={p.id} className="p-4 border-b border-neutral"><img src={p.imgs[0]} className="w-24 h-24 object-cover mx-auto mb-2 rounded"/><div className="font-bold text-center">{p.name}</div><div className="text-center text-accent my-2">{p.priceText || fmtPrice(p.price)}</div><button className="text-graytext hover:text-red-500 w-full text-center" onClick={()=>toggleComp(p)}>Удалить</button></th>)}</tr></thead>
                                <tbody>
                                    {keys.map(k => {
                                        const vals = comp.map(p => p.specs?.[k] || '-');
                                        const isDiff = new Set(vals).size > 1; // Подсветка отличий
                                        return <tr key={k} className={`border-b border-neutral ${isDiff ? 'diff-highlight' : ''}`}><td className="p-4 font-medium text-graytext">{k}</td>{vals.map((v,i) => <td key={i} className="p-4 text-center">{v}</td>)}</tr>
                                    })}
                                </tbody>
                            </table>
                        </div>
                    </div>
                );
            };

            // 3.5 CART & CHECKOUT
            const Cart = () => {
                const total = cart.reduce((s,i) => s + (i.finalPrice * i.qty), 0);
                const hasPre = cart.some(i => i.stock !== 'В наличии');
                if(!cart.length) return <div className="text-center py-20"><TopBar/><h2 className="text-2xl font-bold mb-4">Корзина пуста</h2><Btn onClick={()=>nav('catalog')}>Перейти к покупкам</Btn></div>;
                return (
                    <div className="max-w-4xl mx-auto fade-in">
                        <TopBar />
                        <h1 className="text-2xl font-bold mb-6">Корзина</h1>
                        <div className="grid md:grid-cols-3 gap-8">
                            <div className="md:col-span-2 space-y-4">
                                {cart.map((i, idx) => (
                                    <div key={idx} className="bg-white p-4 rounded-xl flex items-center gap-4 border border-neutral">
                                        <img src={i.imgs[0]} className="w-20 h-20 object-cover rounded" />
                                        <div className="flex-1"><h4 className="font-bold">{i.name}</h4><div className="text-sm text-graytext">{i.variant}</div>{i.stock!=='В наличии' && <div className="text-xs text-orange-500 mt-1">{i.deliveryText}</div>}</div>
                                        <div className="font-bold whitespace-nowrap">{fmtPrice(i.finalPrice)}</div>
                                        <button onClick={()=>setCart(cart.filter((_,x)=>x!==idx))} className="text-graytext hover:text-accent p-2"><i data-lucide="trash-2"></i></button>
                                    </div>
                                ))}
                            </div>
                            <div className="bg-white p-6 rounded-xl border border-neutral h-fit">
                                <h3 className="font-bold text-lg mb-4">Итого</h3>
                                <div className="flex justify-between mb-4"><span>Товары ({cart.length})</span> <span>{fmtPrice(total)}</span></div>
                                {hasPre && <div className="bg-orange-50 p-3 rounded-lg mb-4 text-xs text-orange-800">В заказе товары по предзаказу. Срок поставки ~8 дней.</div>}
                                <div className="flex justify-between text-xl font-bold mb-6 pt-4 border-t border-neutral"><span>К оплате</span> <span className="text-brand">{fmtPrice(total)}</span></div>
                                <Btn cls="w-full py-3" onClick={()=>nav('checkout')}>Оформить заказ</Btn>
                            </div>
                        </div>
                    </div>
                );
            };

            const Checkout = () => {
                const [b2b, setB2b] = useState(false);
                return (
                    <div className="max-w-3xl mx-auto fade-in">
                        <TopBar />
                        <div className="bg-white p-8 rounded-xl border border-neutral">
                            <h1 className="text-2xl font-bold mb-6">Оформление заказа</h1>
                            
                            {/* B2B Переключатель */}
                            <label className="flex items-center gap-3 mb-8 p-4 border border-neutral rounded-lg bg-base cursor-pointer hover:border-accent transition-colors">
                                <input type="checkbox" checked={b2b} onChange={e=>setB2b(e.target.checked)} className="w-5 h-5 text-accent rounded focus:ring-accent" /> 
                                <span className="font-medium text-brand">Покупка на юридическое лицо (B2B)</span>
                            </label>

                            <form className="space-y-6" onSubmit={e=>{e.preventDefault(); alert('Заказ успешно оформлен!'); setCart([]); nav('home');}}>
                                <div className="grid md:grid-cols-2 gap-4">
                                    {b2b ? (
                                        <>
                                            <div><label className="block text-sm mb-1 font-medium">Название компании</label><input required className="w-full p-2.5 border rounded-lg focus:ring-1 ring-accent outline-none" /></div>
                                            <div><label className="block text-sm mb-1 font-medium">БИН / ИНН</label><input required className="w-full p-2.5 border rounded-lg focus:ring-1 ring-accent outline-none" /></div>
                                            <div className="md:col-span-2"><label className="block text-sm mb-1 font-medium">Юридический адрес</label><input required className="w-full p-2.5 border rounded-lg focus:ring-1 ring-accent outline-none" /></div>
                                            <div className="md:col-span-2 p-4 border border-dashed border-neutral rounded-lg bg-base text-center">
                                                <i data-lucide="upload-cloud" className="mx-auto text-graytext mb-2"></i>
                                                <span className="text-sm font-medium text-brand block mb-2">Прикрепить реквизиты (PDF, Doc)</span>
                                                <input type="file" className="text-sm w-full max-w-xs mx-auto block" />
                                            </div>
                                        </>
                                    ) : (
                                        <>
                                            <div><label className="block text-sm mb-1 font-medium">ФИО получателя</label><input required className="w-full p-2.5 border rounded-lg focus:ring-1 ring-accent outline-none" /></div>
                                        </>
                                    )}
                                    <div><label className="block text-sm mb-1 font-medium">Телефон</label><input required type="tel" placeholder="+7" className="w-full p-2.5 border rounded-lg focus:ring-1 ring-accent outline-none" /></div>
                                    <div className={b2b ? "" : "md:col-span-2"}><label className="block text-sm mb-1 font-medium">Email</label><input required type="email" className="w-full p-2.5 border rounded-lg focus:ring-1 ring-accent outline-none" /></div>
                                </div>

                                {/* Пункт 7: Точные способы доставки и оплаты */}
                                <div className="pt-4 border-t border-neutral">
                                    <label className="block text-sm mb-2 font-bold">Способ доставки</label>
                                    <select className="w-full p-2.5 border rounded-lg bg-white outline-none focus:border-accent">
                                        <option>Курьер (до двери)</option><option>СДЭК</option><option>Boxberry</option><option>Казпочта</option><option>Самовывоз (Алматы)</option>
                                    </select>
                                </div>
                                <div className="pb-4">
                                    <label className="block text-sm mb-2 font-bold">Способ оплаты</label>
                                    <select className="w-full p-2.5 border rounded-lg bg-white outline-none focus:border-accent">
                                        {b2b ? <option>Безналичный расчет (Счет на оплату)</option> : <><option>Kaspi</option><option>Картой онлайн (Эквайринг)</option><option>Банковский перевод</option></>}
                                    </select>
                                </div>

                                <Btn cls="w-full py-4 text-lg">Подтвердить заказ</Btn>
                            </form>
                        </div>
                    </div>
                );
            };

            // 3.6 ADMIN & INTEGRATIONS (Пункт 7 mockup)
            const Admin = () => (
                <div className="fade-in max-w-4xl mx-auto bg-white p-8 rounded-xl border border-neutral">
                    <TopBar />
                    <h1 className="text-2xl font-bold mb-6">Админ. панель: Интеграции (Этап 1)</h1>
                    <div className="grid md:grid-cols-2 gap-8">
                        <div className="p-6 border border-neutral rounded-xl bg-base">
                            <h2 className="font-bold mb-4 flex items-center gap-2"><i data-lucide="file-spreadsheet" className="text-green-600"></i> Импорт товаров (Excel)</h2>
                            <p className="text-sm text-graytext mb-4">Загрузите шаблон Excel для обновления каталога и остатков.</p>
                            <input type="file" accept=".xlsx, .xls" className="block w-full text-sm mb-4" />
                            <Btn v="sec" cls="w-full text-sm" onClick={()=>alert('Импорт запущен')}>Синхронизировать</Btn>
                        </div>
                        <div className="p-6 border border-neutral rounded-xl bg-base">
                            <h2 className="font-bold mb-4 flex items-center gap-2"><i data-lucide="database" className="text-brand"></i> Источники ассортимента</h2>
                            <ul className="space-y-3 text-sm">
                                <li><a href="https://kaspi.kz/shop/search/?q=%3AallMerchants%3A30093000" target="_blank" className="text-accent hover:underline font-medium">Kaspi.kz (JOHNGALTAZ) ↗</a></li>
                                <li><a href="https://m.halykmarket.kz/merchant/27172?f=merchantName%3AJohnGaltAZ%20" target="_blank" className="text-accent hover:underline font-medium">Halyk Market (JohnGaltAZ) ↗</a></li>
                            </ul>
                            <p className="text-xs text-graytext mt-4 mt-auto">Примечание: На этапе 1 автоматический парсинг по API не подключен. Наполнение выполняется через Excel-импорт.</p>
                        </div>
                    </div>
                </div>
            );

            // --- MAIN RENDER ---
            return (
                <div className="min-h-screen flex flex-col font-sans pb-24">
                    <Header />
                    <main className="flex-1 max-w-7xl mx-auto w-full p-4 py-8">
                        {view === 'home' && <Home />}
                        {view === 'catalog' && <Catalog />}
                        {view === 'pdp' && <PDP />}
                        {view === 'compare' && <Compare />}
                        {view === 'cart' && <Cart />}
                        {view === 'checkout' && <Checkout />}
                        {view === 'admin' && <Admin />}
                    </main>

                    {/* Footer (Admin link) */}
                    <footer className="bg-brand text-graytext py-8 text-center text-sm mt-auto">
                        <div className="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-4">
                            <div>© 2024 JOHNGALTAZ. Все права защищены.</div>
                            <button onClick={()=>nav('admin')} className="hover:text-white transition-colors flex items-center gap-1"><i data-lucide="settings" className="w-4 h-4"></i> Управление / Интеграции</button>
                        </div>
                    </footer>

                    {/* ПЛАВАЮЩИЕ КНОПКИ (Speed Dial) - Пункт 6 */}
                    <div className="fixed bottom-6 right-6 flex flex-col items-end gap-3 z-50">
                        {fabOpen && (
                            <div className="flex flex-col gap-3 fade-in mb-2">
                                <button className="bg-[#27A7E7] text-white p-3 rounded-full shadow-lg hover:scale-110 flex items-center gap-2" title="Telegram"><i data-lucide="send"></i></button>
                                <button className="bg-[#25D366] text-white p-3 rounded-full shadow-lg hover:scale-110 flex items-center gap-2" title="WhatsApp"><i data-lucide="message-circle"></i></button>
                            </div>
                        )}
                        <button onClick={()=>setFabOpen(!fabOpen)} className="bg-brand text-white p-4 rounded-full shadow-xl hover:bg-accent transition-colors"><i data-lucide={fabOpen ? "x" : "message-square"}></i></button>
                    </div>

                    {/* МОДАЛЬНЫЕ ОКНА */}
                    {modal && (
                        <div className="fixed inset-0 bg-brand/60 backdrop-blur-sm flex items-center justify-center p-4 z-50 fade-in">
                            <div className="bg-white p-8 rounded-xl w-full max-w-md relative shadow-2xl">
                                <button onClick={()=>setModal(null)} className="absolute top-4 right-4 text-graytext hover:text-brand"><i data-lucide="x"></i></button>
                                <h2 className="text-xl font-bold mb-2 text-brand">{modal.t === 'quote' ? 'Запрос КП' : modal.t === '1click' ? 'Купить в 1 клик' : 'Подбор оборудования'}</h2>
                                {modal.p && <p className="text-sm text-graytext mb-6">Товар: {modal.p.name}</p>}
                                <input placeholder={modal.t === 'quote' ? "Компания / ИНН" : "Ваше имя"} className="w-full p-3 border border-neutral rounded-lg mb-4 focus:ring-1 ring-accent outline-none" />
                                <input placeholder="Контактный телефон" type="tel" className="w-full p-3 border border-neutral rounded-lg mb-6 focus:ring-1 ring-accent outline-none" />
                                <Btn cls="w-full py-3" onClick={()=>{alert('Заявка успешно отправлена! Менеджер свяжется с вами.'); setModal(null)}}>Отправить заявку</Btn>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
