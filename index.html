<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JOHNGALTAZ | Официальный интернет-магазин 2026</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: '#0B1416',       
                        accent: '#F85C58',      
                        base: '#F6F6F3',        
                        neutral: '#D6D6D6',     
                        graytext: '#666666'     
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif']
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(11, 20, 22, 0.05)',
                        'glow': '0 0 20px rgba(248, 92, 88, 0.4)',
                    }
                }
            }
        }
    </script>
    
    <style>
        body { 
            background-color: #F6F6F3; 
            color: #0B1416; 
            overflow-x: hidden; 
            -webkit-font-smoothing: antialiased;
        }
        
        /* Скроллбары */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #D6D6D6; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #F85C58; }
        .hide-scroll::-webkit-scrollbar { display: none; }

        /* Анимации */
        .fade-in { animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        
        .spin-slow { animation: spin 2s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Карточки товаров */
        .modern-card {
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 1px solid transparent;
        }
        .modern-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px -5px rgba(11, 20, 22, 0.1);
            border-color: rgba(214, 214, 214, 0.6);
        }

        /* Мега-меню */
        .mega-menu { border-bottom: 3px solid #F85C58; box-shadow: 0 20px 40px rgba(0,0,0,0.4); }
        .cat-visual-card { transition: all 0.3s ease; border: 1px solid rgba(255,255,255,0.05); }
        .cat-visual-card:hover { border-color: #F85C58; background-color: rgba(248, 92, 88, 0.05); }

        /* Сравнение */
        .diff-hl { background-color: rgba(248, 92, 88, 0.08); border-left: 3px solid #F85C58; }

        /* Инпуты */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        
        /* Стилизация кредитной карты */
        .credit-card-bg {
            background: linear-gradient(135deg, #1e293b 0%, #0B1416 100%);
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // ==========================================
        // 1. БАЗА ДАННЫХ И ГЕНЕРАТОР (50 товаров)
        // ==========================================
        
        const CATEGORIES = [
            { id: "Игровые ноутбуки", sub: "Мощные решения", imgId: 1 },
            { id: "Периферия", sub: "Мыши, клавиатуры", imgId: 2 },
            { id: "Косметическое оборудование", sub: "Салонам красоты", imgId: 3 },
            { id: "Медицинское оборудование", sub: "Спец. оборудование", imgId: 4 },
            { id: "Мелко-бытовая техника", sub: "Для дома и офиса", imgId: 5 }
        ];

        // Массивы для рандомизации
        const COLORS = ["Черный", "Белый", "Серый", "Серебристый", "Красный"];
        const SIZES = ["Компактный", "Стандарт", "Крупный", "15.6 дюймов", "17.3 дюймов"];

        const generateProducts = () => {
            const products = [];
            
            // Флагманы
            const flagships = [
                { 
                    id: 1, sku: "THZ-24-PRO", name: "THUNDEROBOT Zero 2024 Ultimate", cat: "Игровые ноутбуки", brand: "Thunderobot", 
                    price: 950000, oldPrice: 1050000, stock: "В наличии", 
                    specs: { "CPU": "i9-13900HX", "GPU": "RTX 4070", "RAM": "32GB", "SSD": "1TB", "Экран": "16' 240Hz", "Цвет": "Черный", "Размер": "16 дюймов" }, 
                    imgs: ["images/tovar1.jpg", "images/tovar2.jpg"], 
                    variants: { ram: [{l:"32GB", d:0}, {l:"64GB", d:80000}], ssd: [{l:"1TB", d:0}, {l:"2TB", d:45000}] }, 
                    desc: { forWhom: "Для хардкорных геймеров.", pros: "Топовая система охлаждения.", box: "Ноутбук, блок питания." }, cross: [3, 15], pop: 500, new: true 
                },
                { 
                    id: 2, sku: "TH911X", name: "Thunderobot 911X", cat: "Игровые ноутбуки", brand: "Thunderobot", 
                    price: 520000, stock: "Предзаказ", deliveryText: "Поставка ~ 8 дней", 
                    specs: { "CPU": "i5-12450H", "GPU": "RTX 3050", "RAM": "16GB", "SSD": "512GB", "Цвет": "Серый" }, 
                    imgs: ["images/tovar3.jpg"], cross: [3], pop: 450, new: false 
                },
                { 
                    id: 3, sku: "ML903", name: "Беспроводная мышь ML903 PRO", cat: "Периферия", brand: "Thunderobot", 
                    price: 35000, stock: "В наличии", specs: { "Сенсор": "PAW3395", "Вес": "65г", "Цвет": "Белый", "Размер": "Стандарт" }, 
                    imgs: ["images/tovar4.jpg"], pop: 300, new: true 
                },
                { 
                    id: 4, sku: "SMAS-UX", name: "Аппарат SMAS-лифтинга UltraX", cat: "Медицинское оборудование", brand: "MedTech", 
                    price: 0, priceText: "По запросу", stock: "Под заказ", deliveryText: "Срок: 20 дней",
                    specs: { "Тип": "SMAS", "Рег. удостоверение": "РК-МТ-0012", "Цвет": "Белый" }, imgs: ["images/tovar5.jpg"], 
                    isB2B: true, warning: "КРИТИЧНО: Требуется мед. лицензия.", docs: ["РУ_МЗ_РК.pdf"], pop: 150, new: false 
                }
            ];
            products.push(...flagships);

            // Генерация остальных 46 товаров
            const brands = ["Thunderobot", "Logitech", "MedTech", "CosmePro", "HomeTech", "Samsung"];
            const cpus = ["i5-12450H", "i7-12700H", "i9-13900HX", "Ryzen 7"];
            const gpus = ["RTX 3050", "RTX 3060", "RTX 4070"];

            for (let i = 5; i <= 50; i++) {
                let cat, name, specs, isB2B = false;
                const color = COLORS[i % COLORS.length];
                const size = SIZES[i % SIZES.length];

                if (i % 5 === 0) {
                    cat = "Периферия"; name = `Игровая клавиатура V${i}`;
                    specs = { "Тип": "Механическая", "Цвет": color, "Размер": size };
                } else if (i % 7 === 0) {
                    cat = "Медицинское оборудование"; name = `УЗИ Аппарат M${i}`;
                    specs = { "Датчики": "Конвексный", "Цвет": color }; isB2B = true;
                } else if (i % 11 === 0) {
                    cat = "Косметическое оборудование"; name = `Лазерный эпилятор Pro ${i}`;
                    specs = { "Мощность": "1200W", "Цвет": color }; isB2B = true;
                } else {
                    cat = "Игровые ноутбуки"; name = `Ноутбук Gaming Pro G${i}`;
                    specs = { "CPU": cpus[i % cpus.length], "GPU": gpus[i % gpus.length], "RAM": "16GB", "SSD": "512GB", "Цвет": color, "Размер": size };
                }

                products.push({
                    id: i, sku: `GEN-${i}`, name: name, cat: cat, brand: brands[i % brands.length],
                    price: isB2B ? (1000000 + i*10000) : (150000 + i*5000), oldPrice: i%4===0 ? 250000+i*5000 : null,
                    stock: i%3===0 ? "Предзаказ" : "В наличии", deliveryText: i%3===0 ? "~8 дней" : "",
                    specs: specs, imgs: [`images/tovar${i}.jpg`], isB2B: isB2B, pop: Math.random()*100, new: i%6===0
                });
            }
            return products;
        };

        const DB = generateProducts();

        // ==========================================
        // 2. UI КОМПОНЕНТЫ
        // ==========================================

        const SafeImage = ({ src, alt, className }) => {
            const [hasError, setHasError] = useState(false);
            if (hasError) return (
                <div className={`flex flex-col items-center justify-center bg-neutral/20 text-graytext rounded-xl ${className} min-h-[140px] w-full border border-dashed border-neutral`}>
                    <i data-lucide="image-off" className="w-8 h-8 mb-2 opacity-40"></i>
                    <span className="text-[10px] px-2 text-center uppercase tracking-wider font-bold opacity-60">Фото товара</span>
                </div>
            );
            return <img src={src} alt={alt} className={className} onError={() => setHasError(true)} />;
        };

        const Button = ({ children, variant = 'primary', className = '', onClick, type = "button", disabled = false, title }) => {
            const base = "px-6 py-3 rounded-xl font-bold transition-all duration-300 ease-out flex items-center justify-center gap-2 transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed";
            const variants = {
                primary: "bg-accent text-white shadow-lg shadow-accent/30 hover:shadow-xl hover:-translate-y-0.5",
                secondary: "bg-brand text-white shadow-lg hover:shadow-xl hover:bg-brand/90 hover:-translate-y-0.5",
                outline: "border-2 border-neutral text-brand hover:border-brand hover:bg-neutral/10",
                ghost: "text-graytext hover:text-brand bg-transparent hover:bg-neutral/20",
                danger: "bg-red-50 text-red-600 hover:bg-red-100 border border-red-200"
            };
            return <button type={type} className={`${base} ${variants[variant]} ${className}`} onClick={onClick} disabled={disabled} title={title}>{children}</button>;
        };

        const InputField = ({ label, required, ...props }) => (
            <div className="flex flex-col gap-1.5 w-full">
                {label && <label className="text-xs font-bold text-graytext uppercase tracking-wider">{label} {required && <span className="text-accent">*</span>}</label>}
                <input required={required} className="w-full p-3.5 bg-white border border-neutral rounded-xl focus:border-accent focus:ring-2 focus:ring-accent/20 outline-none transition-all shadow-sm" {...props} />
            </div>
        );

        const SelectField = ({ label, required, options, ...props }) => (
            <div className="flex flex-col gap-1.5 w-full">
                {label && <label className="text-xs font-bold text-graytext uppercase tracking-wider">{label} {required && <span className="text-accent">*</span>}</label>}
                <select required={required} className="w-full p-3.5 bg-white border border-neutral rounded-xl focus:border-accent focus:ring-2 focus:ring-accent/20 outline-none transition-all shadow-sm appearance-none cursor-pointer" {...props}>
                    {options.map((opt, i) => <option key={i} value={opt.value !== undefined ? opt.value : opt}>{opt.label || opt}</option>)}
                </select>
            </div>
        );

        // ==========================================
        // 3. ГЛАВНОЕ ПРИЛОЖЕНИЕ
        // ==========================================

        const App = () => {
            // Маршрутизация
            const [view, setView] = useState('home');
            const [history, setHistory] = useState(['home']);
            const [activeProduct, setActiveProduct] = useState(null);
            
            // Состояние корзины и списков
            const [cart, setCart] = useState([]);
            const [compare, setCompare] = useState([]);
            const [favorites, setFavorites] = useState([]);
            
            // UI
            const [modal, setModal] = useState(null); // Лиды
            const [quickViewProduct, setQuickViewProduct] = useState(null); // Быстрый просмотр
            const [paymentModalOpen, setPaymentModalOpen] = useState(false); // Оплата картой
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            const [toastMsg, setToastMsg] = useState(null);

            // Поиск и Фильтры
            const [globalSearch, setGlobalSearch] = useState('');
            const [fCategory, setFCategory] = useState('Все');
            const [fBrand, setFBrand] = useState('');
            const [fSort, setFSort] = useState('pop');
            const [fPrice, setFPrice] = useState(3000000);
            const [fInStock, setFInStock] = useState(false);
            const [fCpu, setFCpu] = useState('');
            const [fGpu, setFGpu] = useState('');
            const [fColor, setFColor] = useState(''); // Новый фильтр ЦВЕТ
            const [fSize, setFSize] = useState('');   // Новый фильтр РАЗМЕР
            
            // Мобильные фильтры
            const [showMobileFilters, setShowMobileFilters] = useState(false);

            // Утилиты
            const formatPrice = p => p === 0 ? "По запросу" : new Intl.NumberFormat('ru-KZ').format(p) + ' ₸';
            
            const showToast = (msg) => { setToastMsg(msg); setTimeout(() => setToastMsg(null), 3000); };

            const navigate = (newView, data = null) => { 
                window.scrollTo({ top: 0, behavior: 'smooth' }); 
                if (data) setActiveProduct(data); 
                setHistory(prev => [...prev, newView]); 
                setView(newView); 
                setMobileMenuOpen(false); 
            };
            
            const goBack = () => { 
                if (history.length > 1) { 
                    const newHist = [...history]; newHist.pop(); setHistory(newHist); setView(newHist[newHist.length - 1]); 
                } else navigate('home'); 
            };
            
            const addToCart = (product, qty = 1, variantStr = "", finalPrice = product.price) => { 
                const cartItemId = `${product.id}-${variantStr}`;
                setCart(prev => {
                    const existing = prev.find(item => item.cartItemId === cartItemId);
                    if (existing) return prev.map(item => item.cartItemId === cartItemId ? { ...item, qty: item.qty + qty } : item);
                    return [...prev, { ...product, cartItemId, qty, finalPrice, variantStr }];
                });
                showToast(`Товар добавлен в корзину`); 
                if(quickViewProduct) setQuickViewProduct(null); // Закрыть QuickView при добавлении
            };

            const toggleFav = (product) => {
                setFavorites(prev => {
                    if (prev.find(x => x.id === product.id)) { showToast('Удалено из избранного'); return prev.filter(x => x.id !== product.id); } 
                    else { showToast('Добавлено в избранное'); return [...prev, product]; }
                });
            };

            const toggleCompare = (product) => { 
                setCompare(prev => { 
                    if (prev.find(x => x.id === product.id)) return prev.filter(x => x.id !== product.id);
                    if (prev.length >= 4) { alert('Максимум 4 товара для сравнения.'); return prev; } 
                    showToast('Добавлено к сравнению'); return [...prev, product]; 
                }); 
            };

            // Безопасная загрузка иконок
            useEffect(() => { 
                try { if (window.lucide && window.lucide.createIcons) window.lucide.createIcons(); } catch (e) {} 
            });

            // ==========================================
            // ЛОКАЛЬНЫЕ КОМПОНЕНТЫ
            // ==========================================

            const TopBar = () => (
                <div className="mb-6 flex justify-between items-center">
                    {view !== 'home' ? <Button variant="ghost" className="px-3 py-2 text-sm" onClick={goBack}><i data-lucide="arrow-left" className="w-4 h-4"></i> Назад</Button> : <div></div>}
                </div>
            );

            const Header = () => (
                <header className="bg-brand text-white sticky top-0 z-40">
                    <div className="border-b border-graytext/20 text-[11px] hidden md:block bg-[#070D0E]">
                        <div className="max-w-7xl mx-auto px-4 py-2 flex justify-between text-neutral font-medium">
                            <div className="flex gap-6">
                                <span className="flex items-center gap-1.5"><i data-lucide="map-pin" className="w-3.5 h-3.5 text-accent"></i> Алматы</span>
                                <button onClick={()=>navigate('order-status')} className="flex items-center gap-1.5 hover:text-white transition-colors text-green-400"><i data-lucide="package-search" className="w-3.5 h-3.5"></i> Отследить заказ</button>
                            </div>
                            <div className="flex gap-6">
                                <button onClick={()=>navigate('info')} className="hover:text-accent">Гарантия</button>
                                <button onClick={()=>navigate('b2b')} className="text-accent hover:text-white">B2B Отдел</button>
                                <span className="font-bold flex items-center gap-1.5"><i data-lucide="phone" className="w-3.5 h-3.5"></i> 8 800 123 45 67</span>
                            </div>
                        </div>
                    </div>
                    
                    <div className="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center gap-6 relative">
                        <div className="flex items-center gap-4">
                            <button className="lg:hidden p-2 hover:bg-white/10 rounded-lg" onClick={()=>setMobileMenuOpen(!mobileMenuOpen)}><i data-lucide={mobileMenuOpen ? "x" : "menu"} className="w-6 h-6"></i></button>
                            <div className="text-xl md:text-2xl font-black cursor-pointer tracking-widest uppercase flex items-center gap-2" onClick={()=>navigate('home')}>
                                <div className="w-8 h-8 bg-accent flex items-center justify-center rounded-lg shadow-glow"><i data-lucide="cpu" className="w-5 h-5 text-white"></i></div>
                                JOHNGALTAZ
                            </div>
                        </div>
                        
                        <nav className="hidden lg:flex gap-8 text-xs font-bold items-center h-full uppercase tracking-wider">
                            <button className="hover:text-accent transition-colors" onClick={()=>navigate('home')}>Главная</button>
                            <div className="group py-6 relative">
                                <button className="hover:text-accent transition-colors flex items-center gap-1.5" onClick={()=>{setFCategory('Все'); navigate('catalog');}}>Каталог <i data-lucide="chevron-down" className="w-4 h-4 transition-transform group-hover:rotate-180"></i></button>
                                <div className="absolute top-[70px] -left-[300px] w-[1000px] bg-[#0B1416] mega-menu opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 p-8 z-50 rounded-b-2xl">
                                    <div className="flex justify-between items-center mb-6 pb-4 border-b border-graytext/20">
                                        <h3 className="text-xl font-bold">Оборудование</h3>
                                        <button className="text-accent text-sm hover:underline normal-case" onClick={()=>{setFCategory('Все'); navigate('catalog');}}>Смотреть всё →</button>
                                    </div>
                                    <div className="grid grid-cols-5 gap-6">
                                        {CATEGORIES.map((c, idx) => (
                                            <div key={idx} onClick={()=>{setFCategory(c.id); navigate('catalog');}} className="bg-[#111A1C] rounded-2xl p-5 cursor-pointer cat-visual-card flex flex-col items-center text-center">
                                                <div className="h-28 flex items-center justify-center mb-4"><SafeImage src={`images/tovar${c.imgId}.jpg`} alt={c.id} className="max-h-full max-w-full object-contain" /></div>
                                                <span className="text-accent text-[10px] mb-1.5 uppercase font-bold">{c.sub}</span>
                                                <span className="font-bold text-sm">{c.id}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                            <button className="hover:text-accent" onClick={()=>navigate('info')}>Информация</button>
                        </nav>

                        <div className="flex-1 max-w-sm hidden md:block relative">
                            <input type="text" placeholder="Поиск (напр: RTX 4070)..." value={globalSearch} onChange={e=>{setGlobalSearch(e.target.value); setSearch(e.target.value); if(view !== 'catalog') navigate('catalog');}} className="w-full bg-[#1A2528] border-none rounded-full pl-5 pr-10 py-2.5 outline-none focus:bg-white focus:text-brand text-sm text-white transition-all shadow-inner" />
                            <i data-lucide="search" className="absolute right-4 top-3 w-4 h-4 text-graytext"></i>
                        </div>

                        <div className="flex gap-2 items-center">
                            <button onClick={()=>navigate('wishlist')} className="relative p-2.5 hover:bg-white/10 rounded-full" title="Избранное"><i data-lucide="heart" className="w-5 h-5"></i>{favorites.length>0 && <span className="absolute top-1 right-1 bg-accent text-[10px] rounded-full w-4 h-4 flex items-center justify-center font-bold">{favorites.length}</span>}</button>
                            <button onClick={()=>navigate('compare')} className="relative p-2.5 hover:bg-white/10 rounded-full" title="Сравнение моделей"><i data-lucide="arrow-left-right" className="w-5 h-5"></i>{compare.length>0 && <span className="absolute top-1 right-1 bg-accent text-[10px] rounded-full w-4 h-4 flex items-center justify-center font-bold">{compare.length}</span>}</button>
                            <button onClick={()=>navigate('cart')} className="relative p-3 bg-accent hover:bg-white hover:text-brand rounded-full transition-colors ml-2" title="Корзина"><i data-lucide="shopping-cart" className="w-5 h-5"></i>{cart.length>0 && <span className="absolute -top-1 -right-1 bg-brand text-white border-2 border-brand text-[10px] rounded-full w-5 h-5 flex items-center justify-center font-bold">{cart.reduce((a,c)=>a+c.qty,0)}</span>}</button>
                        </div>
                    </div>

                    {mobileMenuOpen && (
                        <div className="lg:hidden bg-[#070D0E] p-4 flex flex-col gap-3 border-t border-graytext/20 shadow-inner">
                            <input type="text" placeholder="Поиск товара..." value={globalSearch} onChange={e=>{setGlobalSearch(e.target.value); setSearch(e.target.value); navigate('catalog');}} className="w-full bg-[#1A2528] rounded-xl p-3 text-white outline-none focus:border focus:border-accent" />
                            <button onClick={()=>navigate('home')} className="text-left font-bold p-3 bg-white/5 rounded-lg flex items-center gap-3"><i data-lucide="home" className="w-5 h-5"></i> Главная</button>
                            <button onClick={()=>{setFCategory('Все'); navigate('catalog');}} className="text-left font-bold p-3 bg-white/5 rounded-lg flex items-center gap-3"><i data-lucide="grid" className="w-5 h-5"></i> Каталог</button>
                            <button onClick={()=>navigate('order-status')} className="text-left font-bold p-3 bg-white/5 rounded-lg flex items-center gap-3 text-green-400"><i data-lucide="package" className="w-5 h-5"></i> Отследить заказ</button>
                            <button onClick={()=>navigate('b2b')} className="text-left font-bold p-3 bg-accent/10 rounded-lg flex items-center gap-3 text-accent"><i data-lucide="briefcase" className="w-5 h-5"></i> B2B Раздел</button>
                        </div>
                    )}
                </header>
            );

            const ProductCard = ({ product }) => {
                const isAvail = product.stock === 'В наличии';
                
                return (
                    <div className="modern-card bg-white rounded-3xl p-5 flex flex-col relative h-full group border border-neutral/50">
                        {/* Бейджи */}
                        <div className="absolute top-4 left-4 z-10 flex flex-col gap-1.5 pointer-events-none">
                            {product.oldPrice && <span className="bg-accent text-white text-[10px] uppercase px-2 py-1 rounded-md font-bold shadow-sm">Акция</span>}
                            {product.new && <span className="bg-brand text-white text-[10px] uppercase px-2 py-1 rounded-md font-bold shadow-sm">Новинка</span>}
                        </div>

                        {/* Кнопки действий (Адаптация под мобилки: opacity-100 lg:opacity-0) */}
                        <div className="absolute top-3 right-3 flex flex-col gap-2 opacity-100 lg:opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-20">
                            <button onClick={(e)=>{e.stopPropagation(); toggleFav(product);}} title="В избранное" className={`w-9 h-9 bg-white rounded-full shadow-md flex items-center justify-center hover:scale-110 transition-transform ${favorites.find(x=>x.id===product.id)?'text-accent':'text-graytext hover:text-brand'}`}><i data-lucide="heart" className={`w-4 h-4 ${favorites.find(x=>x.id===product.id)?'fill-current':''}`}></i></button>
                            <button onClick={(e)=>{e.stopPropagation(); toggleCompare(product);}} title="Сравнить" className={`w-9 h-9 bg-white rounded-full shadow-md flex items-center justify-center hover:scale-110 transition-transform ${compare.find(x=>x.id===product.id)?'text-brand':'text-graytext hover:text-brand'}`}><i data-lucide="arrow-left-right" className="w-4 h-4"></i></button>
                            {/* Кнопка быстрого просмотра */}
                            <button onClick={(e)=>{e.stopPropagation(); setQuickViewProduct(product);}} title="Быстрый просмотр" className="w-9 h-9 bg-white text-graytext hover:text-accent rounded-full shadow-md flex items-center justify-center hover:scale-110 transition-transform"><i data-lucide="eye" className="w-4 h-4"></i></button>
                        </div>

                        <div className="relative aspect-square mb-5 bg-base rounded-2xl overflow-hidden cursor-pointer flex items-center justify-center p-4" onClick={()=>navigate('pdp', product)}>
                            <SafeImage src={product.imgs[0]} alt={product.name} className="max-w-full max-h-full object-contain mix-blend-multiply group-hover:scale-110 transition-transform duration-500" />
                        </div>

                        <div className="flex flex-col flex-1">
                            <span className="text-[10px] text-graytext uppercase font-bold tracking-widest mb-1">{product.cat}</span>
                            <h3 className="font-bold text-brand hover:text-accent text-sm md:text-base leading-tight cursor-pointer mb-3" onClick={()=>navigate('pdp', product)}>{product.name}</h3>
                            
                            <div className="flex flex-wrap gap-1.5 mb-4">
                                {Object.values(product.specs||{}).slice(0, 4).map((s,i) => <span key={i} className="text-[10px] bg-base px-2 py-1 rounded-md text-graytext border border-neutral/60">{s}</span>)}
                            </div>
                            
                            <div className="mt-auto">
                                <div className={`text-[11px] mb-2 font-bold flex items-center gap-1.5 ${isAvail ? 'text-green-600' : 'text-orange-500'}`}>
                                    <div className={`w-1.5 h-1.5 rounded-full ${isAvail ? 'bg-green-600' : 'bg-orange-500'}`}></div> {product.stock}
                                </div>
                                
                                <div className="mb-5 flex flex-col justify-end min-h-[50px]">
                                    {product.oldPrice && <div className="text-xs text-graytext line-through mb-0.5">{formatPrice(product.oldPrice)}</div>}
                                    <div className="text-xl font-black text-brand tracking-tight">{product.priceText || formatPrice(product.price)}</div>
                                </div>

                                <div className="flex gap-2 w-full">
                                    {product.isB2B ? (
                                        <Button variant="secondary" className="w-full text-xs py-3" onClick={()=>setModal({t:'quote', p: product})}>Запросить КП</Button>
                                    ) : (
                                        <>
                                            <Button className="flex-1 text-xs py-3 px-0 shadow-md" onClick={()=>addToCart(product)}><i data-lucide="shopping-cart" className="w-4 h-4"></i> Корзина</Button>
                                            <Button variant="outline" className="flex-1 text-xs py-3 px-0" onClick={()=>setModal({t:'1click', p: product})}>В 1 клик</Button>
                                        </>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // ==========================================
            // НОВЫЕ ФУНКЦИОНАЛЬНЫЕ МОДАЛКИ (Быстрый просмотр и Оплата)
            // ==========================================
            
            // Быстрый просмотр фото (Quick View)
            const QuickViewModal = () => {
                if(!quickViewProduct) return null;
                const p = quickViewProduct;
                const [idx, setIdx] = useState(0);
                
                return (
                    <div className="fixed inset-0 bg-brand/90 backdrop-blur-md flex items-center justify-center p-4 z-[80] fade-in">
                        <div className="bg-white rounded-3xl w-full max-w-4xl flex flex-col md:flex-row overflow-hidden shadow-2xl relative">
                            <button onClick={()=>setQuickViewProduct(null)} className="absolute top-4 right-4 z-10 w-10 h-10 bg-white/50 backdrop-blur rounded-full flex items-center justify-center hover:bg-brand hover:text-white transition-colors"><i data-lucide="x" className="w-5 h-5"></i></button>
                            
                            {/* Левая часть: Большое фото */}
                            <div className="md:w-3/5 bg-base p-8 flex flex-col items-center justify-center relative">
                                <SafeImage src={p.imgs[idx]} alt={p.name} className="max-w-full max-h-[400px] object-contain mix-blend-multiply" />
                                {p.imgs.length > 1 && (
                                    <div className="flex gap-2 mt-6">
                                        {p.imgs.map((im, i) => (
                                            <button key={i} onClick={()=>setIdx(i)} className={`w-14 h-14 rounded-lg border-2 p-1 bg-white ${idx===i ? 'border-accent' : 'border-transparent'}`}><SafeImage src={im} alt="thumb" className="w-full h-full object-contain" /></button>
                                        ))}
                                    </div>
                                )}
                            </div>
                            
                            {/* Правая часть: Мини-инфо */}
                            <div className="md:w-2/5 p-8 flex flex-col bg-white">
                                <span className="text-xs text-graytext uppercase font-bold mb-2">{p.cat}</span>
                                <h2 className="text-2xl font-black mb-4">{p.name}</h2>
                                <div className="text-3xl font-black text-brand mb-6">{p.priceText || formatPrice(p.price)}</div>
                                
                                <div className="space-y-2 mb-8 flex-1">
                                    {Object.entries(p.specs||{}).slice(0,5).map(([k,v]) => (
                                        <div key={k} className="flex justify-between text-sm border-b border-neutral/50 pb-2"><span className="text-graytext">{k}</span><span className="font-bold">{v}</span></div>
                                    ))}
                                </div>
                                
                                <Button className="w-full py-4 text-lg mb-3 shadow-lg" onClick={()=>addToCart(p)}>В корзину</Button>
                                <Button variant="outline" className="w-full py-3" onClick={()=>{setQuickViewProduct(null); navigate('pdp', p);}}>Подробнее о товаре</Button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Симуляция Оплаты Картой
            const CardPaymentModal = ({ onComplete }) => {
                const [step, setStep] = useState('input'); // input -> processing -> success

                const processPayment = (e) => {
                    e.preventDefault();
                    setStep('processing');
                    setTimeout(() => setStep('success'), 2500);
                    setTimeout(() => onComplete(), 5000);
                };

                return (
                    <div className="fixed inset-0 bg-brand/90 backdrop-blur-md flex items-center justify-center p-4 z-[90] fade-in">
                        <div className="bg-white rounded-[2rem] w-full max-w-md p-8 relative shadow-2xl overflow-hidden">
                            {step === 'input' && (
                                <form onSubmit={processPayment} className="fade-in">
                                    <div className="flex justify-between items-center mb-6">
                                        <h2 className="text-2xl font-black">Оплата картой</h2>
                                        <div className="flex gap-2"><i data-lucide="credit-card" className="w-6 h-6 text-brand"></i></div>
                                    </div>
                                    
                                    {/* Визуальная карта */}
                                    <div className="credit-card-bg rounded-2xl p-6 text-white mb-8 relative">
                                        <i data-lucide="wifi" className="w-6 h-6 mb-4 transform rotate-90 opacity-50"></i>
                                        <div className="text-xl font-mono tracking-widest mb-4 opacity-80">#### #### #### ####</div>
                                        <div className="flex justify-between text-xs font-mono opacity-80"><span>CARDHOLDER NAME</span><span>MM/YY</span></div>
                                    </div>

                                    <div className="space-y-4 mb-8">
                                        <InputField label="Номер карты" required placeholder="0000 0000 0000 0000" maxLength="19" />
                                        <div className="grid grid-cols-2 gap-4">
                                            <InputField label="Срок действия" required placeholder="ММ/ГГ" maxLength="5" />
                                            <InputField label="CVC / CVV" required type="password" placeholder="***" maxLength="3" />
                                        </div>
                                        <InputField label="Имя владельца" required placeholder="IVAN IVANOV" />
                                    </div>
                                    <Button type="submit" className="w-full py-4 text-lg bg-green-600 hover:bg-green-700 shadow-green-600/30">Оплатить {formatPrice(cart.reduce((s,i)=>s+i.finalPrice*i.qty,0))}</Button>
                                </form>
                            )}
                            
                            {step === 'processing' && (
                                <div className="text-center py-12 fade-in flex flex-col items-center">
                                    <i data-lucide="loader-2" className="w-16 h-16 text-accent spin-slow mb-6"></i>
                                    <h2 className="text-2xl font-black mb-2">Обработка платежа...</h2>
                                    <p className="text-graytext">Пожалуйста, не закрывайте окно</p>
                                </div>
                            )}

                            {step === 'success' && (
                                <div className="text-center py-12 fade-in flex flex-col items-center">
                                    <div className="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mb-6"><i data-lucide="check-circle-2" className="w-10 h-10"></i></div>
                                    <h2 className="text-3xl font-black mb-2 text-brand">Оплата прошла!</h2>
                                    <p className="text-graytext mb-6">Ваш заказ успешно сформирован.</p>
                                    <p className="text-sm font-bold text-accent animate-pulse">Перенаправление...</p>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            // ==========================================
            // VIEWS (СТРАНИЦЫ)
            // ==========================================

            // Отслеживание заказа (Новая функция)
            const OrderTrackingView = () => {
                const [trackId, setTrackId] = useState('');
                const [status, setStatus] = useState(null); // 'found'

                const handleTrack = (e) => {
                    e.preventDefault();
                    // Имитация успешного поиска
                    setStatus('found');
                };

                return (
                    <div className="fade-in max-w-4xl mx-auto">
                        <TopBar />
                        <div className="bg-[#070D0E] text-white rounded-3xl p-10 md:p-16 mb-8 text-center shadow-2xl relative overflow-hidden">
                            <i data-lucide="package-search" className="w-16 h-16 text-accent mx-auto mb-6"></i>
                            <h1 className="text-4xl font-black mb-4">Отследить заказ</h1>
                            <p className="text-graytext mb-8 max-w-md mx-auto">Введите номер вашего заказа или номер телефона, чтобы узнать текущий статус.</p>
                            
                            <form onSubmit={handleTrack} className="flex flex-col sm:flex-row gap-4 justify-center max-w-lg mx-auto relative z-10">
                                <input type="text" required placeholder="Номер заказа (напр. #10245)" value={trackId} onChange={e=>setTrackId(e.target.value)} className="w-full sm:w-2/3 p-4 rounded-xl text-brand outline-none focus:ring-4 ring-accent/50 font-bold" />
                                <Button type="submit" className="w-full sm:w-1/3 py-4 shadow-xl">Найти</Button>
                            </form>
                            <div className="absolute inset-0 bg-gradient-to-t from-[#070D0E] to-transparent z-0 pointer-events-none"></div>
                        </div>

                        {status === 'found' && (
                            <div className="bg-white p-8 md:p-12 rounded-3xl border border-neutral shadow-xl fade-in">
                                <div className="flex justify-between items-center mb-10 pb-6 border-b border-neutral">
                                    <div><h3 className="text-2xl font-black">Заказ № {trackId || '10245'}</h3><p className="text-graytext mt-1">Оформлен: Сегодня</p></div>
                                    <div className="bg-blue-50 text-blue-600 px-4 py-2 rounded-lg font-bold">В сборке</div>
                                </div>

                                {/* Таймлайн статусов */}
                                <div className="relative flex flex-col md:flex-row justify-between gap-8 md:gap-0">
                                    <div className="hidden md:block absolute top-6 left-10 right-10 h-1 bg-neutral z-0">
                                        <div className="h-full bg-accent w-1/3 transition-all duration-1000"></div>
                                    </div>
                                    
                                    {[
                                        { s: 'Принят', i: 'clipboard-check', active: true, done: true },
                                        { s: 'В сборке', i: 'box', active: true, done: false },
                                        { s: 'В пути (СДЭК)', i: 'truck', active: false, done: false },
                                        { s: 'Доставлен', i: 'home', active: false, done: false }
                                    ].map((step, idx) => (
                                        <div key={idx} className="relative z-10 flex md:flex-col items-center gap-4 md:gap-3 text-center w-full md:w-1/4">
                                            <div className={`w-12 h-12 rounded-full flex items-center justify-center border-4 ${step.done ? 'bg-accent border-accent text-white' : step.active ? 'bg-white border-accent text-accent' : 'bg-white border-neutral text-neutral'} transition-colors`}>
                                                <i data-lucide={step.i} className="w-5 h-5"></i>
                                            </div>
                                            <div>
                                                <h4 className={`font-bold ${step.active ? 'text-brand' : 'text-graytext'}`}>{step.s}</h4>
                                                {step.active && !step.done && <span className="text-[10px] text-accent font-bold uppercase tracking-widest block mt-1">Текущий этап</span>}
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                <div className="mt-12 bg-base p-6 rounded-2xl flex items-start gap-4 border border-neutral/50">
                                    <i data-lucide="info" className="w-6 h-6 text-brand shrink-0"></i>
                                    <div><h4 className="font-bold mb-1">Ожидаемая дата доставки: через 2-3 дня</h4><p className="text-sm text-graytext">Курьер свяжется с вами за час до прибытия по номеру, указанному в заказе.</p></div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            const CatalogView = () => {
                let results = DB.filter(p => {
                    const matchCat = fCategory === 'Все' || p.cat === fCategory;
                    const matchSearch = p.name.toLowerCase().includes(search.toLowerCase());
                    const matchBrand = fBrand === '' || p.brand === fBrand;
                    const matchPrice = p.price <= fPrice;
                    const matchStock = !fInStock || p.stock === 'В наличии';
                    
                    const matchGpu = fGpu === '' || p.specs?.GPU?.includes(fGpu);
                    const matchCpu = fCpu === '' || p.specs?.CPU?.includes(fCpu);
                    const matchRam = fRam === '' || p.specs?.RAM?.includes(fRam);
                    const matchSsd = fSsd === '' || p.specs?.SSD?.includes(fSsd);
                    const matchColor = fColor === '' || p.specs?.Цвет?.includes(fColor);
                    const matchSize = fSize === '' || p.specs?.Размер?.includes(fSize);

                    return matchCat && matchSearch && matchBrand && matchPrice && matchStock && matchGpu && matchCpu && matchRam && matchSsd && matchColor && matchSize;
                });

                if (fSort === 'pop') results.sort((a,b) => b.pop - a.pop);
                if (fSort === 'cheap') results.sort((a,b) => a.price - b.price);
                if (fSort === 'exp') results.sort((a,b) => b.price - a.price);
                if (fSort === 'new') results.sort((a,b) => (a.new === b.new) ? 0 : a.new ? -1 : 1);

                return (
                    <div className="flex flex-col lg:flex-row gap-8 fade-in">
                        {/* Кнопка фильтров для мобилки */}
                        <div className="lg:hidden w-full mb-2">
                            <Button variant="outline" className="w-full" onClick={()=>setShowMobileFilters(!showMobileFilters)}>
                                <i data-lucide="filter" className="w-5 h-5"></i> {showMobileFilters ? "Скрыть фильтры" : "Показать фильтры"}
                            </Button>
                        </div>

                        {/* Сайдбар */}
                        <aside className={`${showMobileFilters ? 'block' : 'hidden'} lg:block w-full lg:w-[320px] shrink-0 space-y-6 lg:sticky top-24 h-fit`}>
                            <div className="bg-white p-6 md:p-8 rounded-3xl shadow-xl border border-neutral/30">
                                <div className="flex justify-between items-center mb-6 border-b border-neutral pb-4">
                                    <h2 className="text-xl font-black flex items-center gap-2 uppercase tracking-wide"><i data-lucide="sliders-horizontal" className="w-5 h-5 text-accent"></i> Фильтры</h2>
                                    <button onClick={()=>{setFCategory('Все'); setFPrice(3000000); setFInStock(false); setFBrand(''); setFCpu(''); setFGpu(''); setFColor(''); setFSize('');}} className="text-xs text-graytext hover:text-accent font-bold">Сбросить</button>
                                </div>
                                
                                <div className="space-y-6 max-h-[60vh] overflow-y-auto pr-2 custom-scroll">
                                    <div>
                                        <h3 className="text-xs font-bold text-graytext uppercase tracking-widest mb-3">Категория</h3>
                                        <div className="space-y-3">
                                            {['Все', ...CATEGORIES.map(c=>c.id)].map(c => (
                                                <label key={c} className="flex items-center text-sm font-bold cursor-pointer group">
                                                    <input type="radio" checked={fCategory===c} onChange={()=>setFCategory(c)} className="mr-3 w-5 h-5 text-accent border-neutral focus:ring-accent"/>
                                                    <span className="group-hover:text-accent transition-colors">{c}</span>
                                                </label>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="border-t border-neutral pt-6">
                                        <h3 className="text-xs font-bold text-graytext uppercase tracking-widest mb-4">Цена до: <span className="text-brand text-base">{formatPrice(fPrice)}</span></h3>
                                        <input type="range" min="0" max="3000000" step="50000" value={fPrice} onChange={e=>setFPrice(e.target.value)} className="w-full h-2 bg-neutral rounded-lg appearance-none cursor-pointer accent-accent mb-6" />
                                        <label className="flex items-center text-sm font-bold cursor-pointer bg-base p-4 rounded-xl border border-neutral hover:border-accent transition-colors shadow-sm">
                                            <input type="checkbox" checked={fInStock} onChange={e=>setFInStock(e.target.checked)} className="mr-3 w-5 h-5 rounded text-accent focus:ring-accent"/> Только в наличии
                                        </label>
                                    </div>

                                    <div className="border-t border-neutral pt-6 space-y-5">
                                        <SelectField label="Бренд" value={fBrand} onChange={e=>setFBrand(e.target.value)} options={[{value: "", label: "Все бренды"}, "Thunderobot", "MedTech", "CosmePro", "Logitech", "Samsung", "Razer"]} />
                                        
                                        {/* Новые фильтры из ТЗ (Цвет, Размер) */}
                                        <SelectField label="Цвет" value={fColor} onChange={e=>setFColor(e.target.value)} options={[{value: "", label: "Любой"}, ...COLORS]} />
                                        <SelectField label="Размер / Габариты" value={fSize} onChange={e=>setFSize(e.target.value)} options={[{value: "", label: "Любой"}, ...SIZES]} />
                                    </div>
                                    
                                    {fCategory === 'Игровые ноутбуки' && (
                                        <div className="border-t border-neutral pt-6 space-y-5 bg-brand/5 p-4 rounded-2xl mt-6">
                                            <h3 className="text-xs font-bold text-brand uppercase tracking-widest mb-2"><i data-lucide="cpu" className="w-4 h-4 inline mb-1"></i> Характеристики ПК</h3>
                                            <SelectField label="Процессор (CPU)" value={fCpu} onChange={e=>setFCpu(e.target.value)} options={["", "i5-12450H", "i7-12700H", "i9-13900HX", "Ryzen 5 5600H", "Ryzen 7 6800H"]} />
                                            <SelectField label="Видеокарта (GPU)" value={fGpu} onChange={e=>setFGpu(e.target.value)} options={["", "RTX 3050", "RTX 3060", "RTX 4050", "RTX 4060", "RTX 4070"]} />
                                            <div className="grid grid-cols-2 gap-3">
                                                <SelectField label="RAM" value={fRam} onChange={e=>setFRam(e.target.value)} options={["", "8GB", "16GB", "32GB", "64GB"]} />
                                                <SelectField label="SSD" value={fSsd} onChange={e=>setFSsd(e.target.value)} options={["", "512GB", "1TB", "2TB"]} />
                                            </div>
                                        </div>
                                    )}
                                </div>
                                
                                <div className="mt-6 pt-6 border-t border-neutral">
                                    <Button variant="outline" className="w-full text-sm py-4 border-dashed border-2 hover:border-solid hover:bg-brand hover:text-white transition-all shadow-sm" onClick={()=>{setModal({t:'form'}); setShowMobileFilters(false);}}>
                                        <i data-lucide="help-circle" className="w-5 h-5"></i> Нужна помощь?
                                    </Button>
                                </div>
                            </div>
                        </aside>

                        <div className="flex-1">
                            <div className="bg-white p-5 rounded-3xl shadow-sm flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4 border border-neutral/50">
                                <div>
                                    <h1 className="text-2xl md:text-3xl font-black mb-1">{fCategory}</h1>
                                    <span className="text-sm text-graytext font-medium">Найдено: <span className="text-brand font-bold bg-base px-2 py-1 rounded">{results.length}</span> товаров</span>
                                </div>
                                <div className="flex items-center gap-3 w-full md:w-auto bg-base p-1.5 rounded-xl border border-neutral/50">
                                    <div className="bg-white rounded-lg p-2 shadow-sm"><i data-lucide="arrow-up-down" className="w-4 h-4 text-brand"></i></div>
                                    <select className="border-none bg-transparent py-2 pr-4 text-sm font-bold outline-none cursor-pointer w-full md:w-auto" value={fSort} onChange={e=>setFSort(e.target.value)}>
                                        <option value="pop">Сначала популярные</option>
                                        <option value="cheap">Сначала дешевые</option>
                                        <option value="exp">Сначала дорогие</option>
                                        <option value="new">Сначала новинки</option>
                                    </select>
                                </div>
                            </div>

                            {results.length > 0 ? (
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-6 lg:gap-8 items-stretch">
                                    {results.map(p => <ProductCard key={p.id} product={p} />)}
                                </div>
                            ) : (
                                <div className="flex flex-col items-center justify-center py-32 bg-white rounded-3xl shadow-soft border border-dashed border-neutral text-center px-4">
                                    <div className="w-24 h-24 bg-neutral/20 rounded-full flex items-center justify-center mb-6"><i data-lucide="search-x" className="w-12 h-12 text-graytext"></i></div>
                                    <h3 className="text-2xl font-black mb-3">Ничего не найдено</h3>
                                    <p className="text-graytext mb-8 max-w-sm">Мы не смогли найти товары, соответствующие выбранным фильтрам. Попробуйте смягчить условия поиска.</p>
                                    <Button onClick={()=>{setSearch(''); setFCategory('Все'); setFPrice(3000000); setFInStock(false); setFCpu(''); setFGpu(''); setFColor(''); setFSize('');}}>Сбросить все фильтры</Button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            const CheckoutView = () => {
                const [b2bMode, setB2bMode] = useState(false);
                const [payMethod, setPayMethod] = useState("Kaspi / QR");
                
                const handleCheckoutSubmit = (e) => {
                    e.preventDefault(); 
                    if(payMethod === "Оплата картой онлайн (Эквайринг)" && !b2bMode) {
                        setPaymentModalOpen(true); // Открываем шлюз
                    } else {
                        alert('Заказ успешно оформлен! Статус: Новый. Менеджер свяжется с вами.'); 
                        setCart([]); 
                        navigate('order-status');
                    }
                };

                return (
                    <div className="max-w-4xl mx-auto fade-in">
                        <TopBar />
                        <div className="bg-white p-8 md:p-12 rounded-[2.5rem] shadow-2xl border border-neutral relative overflow-hidden">
                            <div className="absolute top-0 right-0 w-64 h-64 bg-accent/5 rounded-full blur-3xl pointer-events-none"></div>
                            
                            <div className="flex items-center gap-5 mb-10 relative z-10">
                                <div className="w-14 h-14 bg-brand text-white rounded-2xl flex items-center justify-center shadow-lg"><i data-lucide="check-square" className="w-7 h-7"></i></div>
                                <div><h1 className="text-3xl font-black tracking-tight">Оформление заказа</h1><p className="text-graytext mt-1">Шаг 2 из 2. Введите данные для доставки</p></div>
                            </div>
                            
                            <label className={`flex items-center gap-5 mb-10 p-6 md:p-8 border-2 rounded-3xl cursor-pointer transition-all ${b2bMode ? 'border-accent bg-accent/5 shadow-inner' : 'border-neutral bg-base hover:border-graytext/40 shadow-sm'}`}>
                                <div className="relative flex items-center justify-center shrink-0">
                                    <input type="checkbox" checked={b2bMode} onChange={e=>{setB2bMode(e.target.checked); setPayMethod(e.target.checked ? "Безналичный расчет (Счет)" : "Kaspi / QR");}} className="peer w-8 h-8 appearance-none border-2 border-graytext rounded-xl checked:bg-accent checked:border-accent transition-all cursor-pointer" />
                                    <i data-lucide="check" className="w-5 h-5 text-white absolute opacity-0 peer-checked:opacity-100 pointer-events-none transition-opacity"></i>
                                </div>
                                <div><span className="font-black text-brand text-xl block mb-1">Покупка на юридическое лицо (B2B)</span><span className="text-sm text-graytext leading-relaxed block">Требуется для выставления счета на оплату и получения пакета закрывающих документов (ЭСФ, накладные, акты).</span></div>
                            </label>
                            
                            <form className="space-y-10 relative z-10" onSubmit={handleCheckoutSubmit}>
                                <div className="bg-base p-6 md:p-8 rounded-3xl border border-neutral/50">
                                    <h3 className="text-xl font-black mb-6 flex items-center gap-2"><i data-lucide="user" className="text-accent"></i> Контактные данные</h3>
                                    <div className="grid md:grid-cols-2 gap-6">
                                        {b2bMode ? (
                                            <>
                                                <InputField label="Название компании" required placeholder='ТОО "Инновации"' />
                                                <InputField label="БИН / ИНН" required placeholder="123456789012" />
                                                <InputField label="Юридический адрес" required placeholder="г. Астана..." />
                                                <InputField label="Email для бухгалтерии" type="email" required placeholder="buh@company.kz" />
                                                <div className="md:col-span-2"><InputField label="ФИО представителя" required placeholder="Иванов Иван" /></div>
                                                <div className="md:col-span-2 p-8 border-2 border-dashed border-neutral hover:border-accent rounded-2xl bg-white text-center transition-colors group cursor-pointer shadow-sm">
                                                    <div className="w-16 h-16 bg-base rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-accent group-hover:text-white transition-colors"><i data-lucide="file-up" className="w-8 h-8 text-graytext group-hover:text-white"></i></div>
                                                    <span className="text-lg font-bold text-brand block mb-2">Прикрепить реквизиты (Карточка предприятия)</span>
                                                    <span className="text-xs text-graytext block mb-6">PDF или Word до 10 МБ (Ускорит выставление счета)</span>
                                                    <input type="file" className="text-sm block mx-auto text-graytext file:mr-4 file:py-2 file:px-6 file:rounded-full file:border-0 file:text-sm file:font-bold file:bg-brand file:text-white hover:file:bg-accent transition-colors cursor-pointer shadow-sm" accept=".pdf,.doc,.docx" />
                                                </div>
                                            </>
                                        ) : (
                                            <div className="md:col-span-2"><InputField label="Ваше ФИО" required placeholder="Иванов Иван Иванович" /></div>
                                        )}
                                        <InputField label="Мобильный телефон" required type="tel" placeholder="+7 (___) ___-__-__" />
                                        {!b2bMode && <InputField label="Email (для чека)" type="email" placeholder="mail@example.com" />}
                                    </div>
                                </div>
                                
                                <div className="bg-base p-6 md:p-8 rounded-3xl border border-neutral/50">
                                    <h3 className="text-xl font-black mb-6 flex items-center gap-2"><i data-lucide="truck" className="text-accent"></i> Параметры доставки</h3>
                                    <div className="grid md:grid-cols-2 gap-6">
                                        <InputField label="Город" required placeholder="Астана" />
                                        <SelectField label="Служба доставки" required options={["Курьер (до двери)", "СДЭК", "Boxberry", "Казпочта", "Самовывоз"]} />
                                        <div className="md:col-span-2"><InputField label="Адрес (улица, дом, квартира)" required placeholder="пр. Мангилик Ел, д. 10" /></div>
                                    </div>
                                </div>

                                <div className="bg-base p-6 md:p-8 rounded-3xl border border-neutral/50">
                                    <h3 className="text-xl font-black mb-6 flex items-center gap-2"><i data-lucide="credit-card" className="text-accent"></i> Оплата</h3>
                                    <SelectField label="Метод оплаты" required value={payMethod} onChange={e=>setPayMethod(e.target.value)} options={b2bMode ? ["Безналичный расчет (Счет)"] : ["Kaspi / QR", "Оплата картой онлайн (Эквайринг)", "Перевод на карту"]} />
                                    {payMethod === "Оплата картой онлайн (Эквайринг)" && <p className="mt-3 text-sm text-green-600 font-bold flex items-center gap-2"><i data-lucide="lock" className="w-4 h-4"></i> Безопасная оплата 3D-Secure</p>}
                                </div>

                                <div>
                                    <label className="text-xs font-bold text-graytext uppercase tracking-wider block mb-2">Дополнительный комментарий</label>
                                    <textarea rows="4" placeholder="Например: Позвонить за час до доставки..." className="w-full p-4 bg-white border border-neutral rounded-2xl focus:border-accent focus:ring-4 focus:ring-accent/10 outline-none transition-all shadow-sm resize-none"></textarea>
                                </div>

                                <div className="pt-8 flex flex-col items-center">
                                    <Button type="submit" className="w-full md:w-auto md:min-w-[400px] py-5 text-xl tracking-wide shadow-2xl shadow-accent/40 rounded-full">
                                        {payMethod === "Оплата картой онлайн (Эквайринг)" ? "Перейти к оплате картой" : "Подтвердить заказ"}
                                    </Button>
                                    <p className="text-xs text-graytext mt-6 text-center max-w-md flex items-center justify-center gap-2"><i data-lucide="shield-check" className="w-4 h-4"></i> Ваши данные защищены</p>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            // ==========================================
            // ГЛАВНЫЙ ВОЗВРАТ (RENDER)
            // ==========================================
            return (
                <div className="min-h-screen flex flex-col font-sans pb-[100px]">
                    <Header />
                    
                    <main className="flex-1 max-w-[1500px] mx-auto w-full p-4 py-8 md:py-12">
                        {view === 'home' && <HomeView />}
                        {view === 'catalog' && <CatalogView />}
                        {view === 'pdp' && <ProductDetailView />}
                        {view === 'compare' && <CompareView />}
                        {view === 'wishlist' && <WishlistView />}
                        {view === 'cart' && <CartView />}
                        {view === 'checkout' && <CheckoutView />}
                        {view === 'info' && <InfoView />}
                        {view === 'b2b' && <B2BPageView />}
                        {view === 'integrations' && <IntegrationsView />}
                        {view === 'order-status' && <OrderTrackingView />}
                    </main>
                    
                    <footer className="bg-[#070D0E] text-graytext py-16 mt-auto border-t-4 border-accent relative z-10">
                        <div className="max-w-7xl mx-auto px-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12">
                            <div className="lg:col-span-2">
                                <h3 className="text-white font-black text-2xl mb-6 tracking-widest uppercase flex items-center gap-2"><i data-lucide="cpu" className="text-accent w-6 h-6"></i> JOHNGALTAZ</h3>
                                <p className="text-sm mb-6 max-w-md leading-relaxed">Крупнейший официальный интернет-магазин профессионального B2B оборудования и топовых геймерских решений на территории Республики Казахстан.</p>
                                <div className="flex gap-4">
                                    <a href="#" className="w-12 h-12 rounded-xl bg-white/5 flex items-center justify-center hover:bg-accent hover:text-white transition-all hover:-translate-y-1"><i data-lucide="instagram" className="w-5 h-5"></i></a>
                                    <a href="#" className="w-12 h-12 rounded-xl bg-white/5 flex items-center justify-center hover:bg-accent hover:text-white transition-all hover:-translate-y-1"><i data-lucide="facebook" className="w-5 h-5"></i></a>
                                    <a href="#" className="w-12 h-12 rounded-xl bg-white/5 flex items-center justify-center hover:bg-accent hover:text-white transition-all hover:-translate-y-1"><i data-lucide="youtube" className="w-5 h-5"></i></a>
                                </div>
                            </div>
                            <div>
                                <h4 className="text-white font-bold text-lg mb-6 uppercase tracking-wider">Навигация</h4>
                                <ul className="space-y-4 text-sm font-medium">
                                    <li><button onClick={()=>{setFCategory('Все'); navigate('catalog');}} className="hover:text-accent transition-colors flex items-center gap-2"><i data-lucide="chevron-right" className="w-4 h-4 text-accent"></i> Каталог товаров</button></li>
                                    <li><button onClick={()=>navigate('order-status')} className="hover:text-accent transition-colors flex items-center gap-2 text-white"><i data-lucide="package-search" className="w-4 h-4 text-accent"></i> Отследить заказ</button></li>
                                    <li><button onClick={()=>navigate('b2b')} className="hover:text-accent transition-colors flex items-center gap-2"><i data-lucide="chevron-right" className="w-4 h-4 text-accent"></i> B2B Отдел (Юр. лицам)</button></li>
                                    <li><button onClick={()=>navigate('info')} className="hover:text-accent transition-colors flex items-center gap-2"><i data-lucide="chevron-right" className="w-4 h-4 text-accent"></i> Доставка и оплата</button></li>
                                    <li className="pt-4 mt-4 border-t border-graytext/20">
                                        <button onClick={()=>navigate('integrations')} className="text-accent hover:text-white transition-colors flex items-center gap-2">
                                            <i data-lucide="settings-2" className="w-4 h-4"></i> Интеграции / Админка
                                        </button>
                                    </li>
                                </ul>
                            </div>
                            <div>
                                <h4 className="text-white font-bold text-lg mb-6 uppercase tracking-wider">Правовая база</h4>
                                <ul className="space-y-4 text-sm font-medium">
                                    <li><button onClick={()=>navigate('info')} className="hover:text-accent transition-colors flex items-center gap-2"><i data-lucide="chevron-right" className="w-4 h-4 text-accent"></i> Политика конфиденциальности</button></li>
                                    <li><button onClick={()=>navigate('info')} className="hover:text-accent transition-colors flex items-center gap-2"><i data-lucide="chevron-right" className="w-4 h-4 text-accent"></i> Пользовательское соглашение</button></li>
                                    <li><button onClick={()=>navigate('info')} className="hover:text-accent transition-colors flex items-center gap-2"><i data-lucide="chevron-right" className="w-4 h-4 text-accent"></i> Гарантия и возврат</button></li>
                                </ul>
                            </div>
                        </div>
                        <div className="max-w-7xl mx-auto px-6 mt-16 pt-8 border-t border-graytext/20 flex flex-col md:flex-row justify-between items-center gap-4">
                            <div className="text-sm font-medium bg-brand py-2 px-4 rounded-lg">© 2026 JOHNGALTAZ. Все права защищены.</div>
                            <div className="flex items-center gap-2 text-xs opacity-50">Разработано <i data-lucide="heart" className="w-3 h-3 text-accent fill-current"></i> Lead Dev AIRIS</div>
                        </div>
                    </footer>
                    
                    {/* Плавающие кнопки соцсетей */}
                    <div className="fixed bottom-8 right-8 flex flex-col gap-4 z-[60]">
                        <a href="#" className="bg-[#27A7E7] text-white p-4 rounded-full shadow-[0_10px_20px_rgba(39,167,231,0.4)] hover:scale-110 hover:-translate-y-1 transition-all"><i data-lucide="send" className="w-6 h-6"></i></a>
                        <a href="#" className="bg-[#25D366] text-white p-4 rounded-full shadow-[0_10px_20px_rgba(37,211,102,0.4)] hover:scale-110 hover:-translate-y-1 transition-all"><i data-lucide="message-circle" className="w-6 h-6"></i></a>
                    </div>

                    {/* Глобальный Toast */}
                    {toastMsg && (
                        <div className="fixed bottom-8 left-1/2 -translate-x-1/2 bg-brand text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-3 z-[100] fade-in border border-white/10">
                            <div className="bg-green-500/20 text-green-400 p-1.5 rounded-full"><i data-lucide="check" className="w-4 h-4"></i></div>
                            <span className="font-bold text-sm">{toastMsg}</span>
                        </div>
                    )}
                    
                    {/* Модалки: Формы лидов */}
                    {modal && (
                        <div className="fixed inset-0 bg-brand/90 backdrop-blur-md flex items-center justify-center p-4 z-[90] fade-in">
                            <div className="bg-white p-8 md:p-12 rounded-[2rem] w-full max-w-md relative shadow-2xl border-t-[6px] border-accent">
                                <button onClick={()=>setModal(null)} className="absolute top-6 right-6 text-graytext hover:text-accent bg-base p-2 rounded-full transition-colors"><i data-lucide="x" className="w-5 h-5"></i></button>
                                <div className="mb-8">
                                    <div className="w-14 h-14 bg-accent/10 text-accent rounded-2xl flex items-center justify-center mb-6"><i data-lucide={modal.t === 'quote' ? 'file-text' : modal.t === '1click' ? 'zap' : modal.t === 'question' ? 'help-circle' : 'sliders-horizontal'} className="w-7 h-7"></i></div>
                                    <h2 className="text-2xl font-black mb-2 tracking-tight">{modal.t === 'quote' ? 'Запрос КП (B2B)' : modal.t === 'question' ? 'Вопрос менеджеру' : modal.t === '1click' ? 'Покупка в 1 клик' : 'Сложный подбор'}</h2>
                                    <p className="text-sm text-graytext leading-relaxed">Оставьте контакты, и специалист перезвонит вам за 15 минут.</p>
                                </div>
                                {modal.p && (
                                    <div className="bg-base p-4 rounded-2xl mb-8 border border-neutral/50 flex items-center gap-4">
                                        <div className="w-14 h-14 bg-white rounded-xl p-1 shrink-0"><SafeImage src={modal.p.imgs[0]} alt="product" className="w-full h-full object-contain mix-blend-multiply" /></div>
                                        <div><span className="text-[10px] uppercase font-bold text-graytext block mb-0.5">Товар</span><span className="font-bold text-brand text-sm line-clamp-2">{modal.p.name}</span></div>
                                    </div>
                                )}
                                <form onSubmit={(e)=>{e.preventDefault(); alert('Заявка успешно отправлена!'); setModal(null);}}>
                                    <div className="space-y-5 mb-8">
                                        <InputField label={modal.t === 'quote' ? "Компания" : "Имя"} placeholder={modal.t === 'quote' ? 'ТОО "Медицина"' : 'Иван'} required />
                                        <InputField label="Телефон" type="tel" placeholder="+7 (___) ___-__-__" required />
                                        {modal.t === 'question' && <textarea required rows="3" placeholder="Ваш вопрос..." className="w-full p-4 bg-white border border-neutral rounded-xl focus:border-accent outline-none resize-none"></textarea>}
                                    </div>
                                    <Button type="submit" className="w-full py-4 text-lg shadow-xl">Отправить</Button>
                                </form>
                            </div>
                        </div>
                    )}

                    {/* Модалки: Быстрый просмотр и Оплата */}
                    <QuickViewModal />
                    {paymentModalOpen && <CardPaymentModal onComplete={() => { setPaymentModalOpen(false); setCart([]); navigate('order-status'); }} />}
                </div>
            );
        };
        
        const root = ReactDOM.createRoot(document.getElementById('root')); root.render(<App />);
    </script>
</body>
</html>
